trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  containerRegistry: 'registrationappacr.azurecr.io'
  acrName: 'registrationappacr'
  tag: '$(Build.BuildId)'

stages:
  - stage: BuildBackend
    displayName: 'Build Backend'
    jobs:
      - job: BuildBackendJob
        displayName: 'Build Backend Docker Image'
        steps:
          - script: |
              echo "Building backend image..."
              docker build -f backend/Dockerfile -t $(containerRegistry)/registration-api:$(tag) -t $(containerRegistry)/registration-api:latest ./backend
              echo "Backend image built successfully"
            displayName: 'Build Backend Docker Image'

  - stage: BuildFrontend
    displayName: 'Build Frontend'
    dependsOn: BuildBackend
    condition: succeeded()
    jobs:
      - job: BuildFrontendJob
        displayName: 'Build Frontend Docker Image'
        steps:
          - script: |
              echo "Building frontend image..."
              docker build -f frontend/Dockerfile -t $(containerRegistry)/registration-frontend:$(tag) -t $(containerRegistry)/registration-frontend:latest ./frontend
              echo "Frontend image built successfully"
            displayName: 'Build Frontend Docker Image'