<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RegistrationApp - Azure Integration Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        header p {
            color: #666;
            font-size: 1.1em;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .status-item {
            background: #f0f4ff;
            padding: 10px 20px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .status-item.complete {
            border-left-color: #10b981;
            background: #f0fdf4;
        }

        .status-item.pending {
            border-left-color: #f59e0b;
            background: #fffbf0;
        }

        nav {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        nav a {
            color: #667eea;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: #f0f4ff;
            color: #764ba2;
        }

        section {
            background: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        section h3 {
            color: #764ba2;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        section h4 {
            color: #667eea;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .diagram-container {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .diagram-container svg {
            display: block;
            margin: 0 auto;
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .service-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .service-card:hover {
            border-color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.1);
            transform: translateY(-5px);
        }

        .service-card h3 {
            margin-top: 0;
            color: #667eea;
        }

        .service-card .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .service-card .status.complete {
            background: #d1fae5;
            color: #065f46;
        }

        .service-card .status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .code-block {
            background: #1f2937;
            color: #e5e7eb;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .code-block code {
            display: block;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .success-box {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        table tr:hover {
            background: #f9fafb;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            padding: 20px;
            padding-left: 40px;
            border-left: 3px solid #667eea;
            margin-left: 10px;
            margin-bottom: 30px;
            position: relative;
        }

        .timeline-item:before {
            content: '';
            position: absolute;
            left: -9px;
            top: 0;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
        }

        .timeline-item h4 {
            margin-top: 0;
            color: #667eea;
        }

        ul, ol {
            margin: 15px 0;
            margin-left: 25px;
        }

        li {
            margin-bottom: 10px;
        }

        a {
            color: #667eea;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .footer {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .footer p {
            margin: 5px 0;
            color: #666;
        }

        .deployment-steps {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .deployment-steps ol {
            margin-left: 30px;
        }

        .deployment-steps li {
            margin-bottom: 15px;
            padding-left: 10px;
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
        }

        .comparison-table td {
            padding: 15px;
        }

        .comparison-table tr:nth-child(even) {
            background: #f9fafb;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .badge.azure {
            background: #e0e7ff;
            color: #667eea;
        }

        .badge.dotnet {
            background: #dbeafe;
            color: #0284c7;
        }

        .badge.feature {
            background: #d1fae5;
            color: #065f46;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            nav ul {
                flex-direction: column;
            }

            .service-grid {
                grid-template-columns: 1fr;
            }

            section {
                padding: 20px;
            }
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üöÄ RegistrationApp - Azure Integration Documentation</h1>
            <p>Complete guide to Azure services, architecture, and deployment</p>
            <div class="status-bar">
                <div class="status-item complete">
                    <strong>‚úÖ Core Services:</strong> 5/5 Complete
                </div>
                <div class="status-item complete">
                    <strong>‚úÖ Function App:</strong> Ready
                </div>
                <div class="status-item pending">
                    <strong>‚è≥ Logic Apps:</strong> Documented
                </div>
                <div class="status-item complete">
                    <strong>‚úÖ Testing:</strong> Verified
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav>
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#usage">How It Works</a></li>
                <li><a href="#deployment">Deployment</a></li>
                <li><a href="#integration">Integration Flow</a></li>
                <li><a href="#monitoring">Monitoring</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </nav>

        <!-- Overview Section -->
        <section id="overview">
            <h2>üìñ Overview</h2>
            <p>
                RegistrationApp is a comprehensive .NET 8.0 ASP.NET Core application integrated with 
                <span class="highlight">5 Azure services</span> for cloud-native development. This documentation 
                covers the complete architecture, implementation, and deployment strategy.
            </p>

            <h3>What We've Built</h3>
            <p>
                A full-stack registration system with:
            </p>
            <ul>
                <li><strong>Backend API:</strong> ASP.NET Core 8.0 with real-time Azure integration</li>
                <li><strong>Data Storage:</strong> SQL Server for relational data + Cosmos DB for audit logs</li>
                <li><strong>File Management:</strong> Azure Storage Blob for uploads and images</li>
                <li><strong>Async Processing:</strong> Service Bus queues for event-driven architecture</li>
                <li><strong>Serverless Functions:</strong> Azure Functions for email notifications</li>
                <li><strong>Monitoring:</strong> Application Insights for observability</li>
                <li><strong>Security:</strong> Azure Key Vault for secrets management</li>
            </ul>

            <div class="success-box">
                <strong>‚úÖ Status:</strong> All core services are deployed, tested, and verified working with 
                real data flowing through the system.
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="architecture">
            <h2>üèóÔ∏è System Architecture</h2>

            <h3>High-Level Architecture Diagram</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    graph TB
                    subgraph Client["Client Layer"]
                        Web["üåê Web Browser<br/>Frontend UI"]
                    end
                    
                    subgraph API["API Layer"]
                        Backend["ASP.NET Core 8.0<br/>REST API<br/>localhost:58082/58083"]
                    end
                    
                    subgraph Core["Core Azure Services"]
                        KeyVault["üîê Key Vault<br/>Secrets Management"]
                        AppInsights["üìä App Insights<br/>Monitoring & Logging"]
                    end
                    
                    subgraph Data["Data Layer"]
                        SQL["üíæ SQL Server<br/>regsql2807<br/>Relational Data"]
                        Cosmos["üìö Cosmos DB<br/>cosmos-registrationapp<br/>Audit Logs"]
                    end
                    
                    subgraph Storage["File Storage"]
                        Blob["‚òÅÔ∏è Storage Account<br/>stregistrationapp2807<br/>Uploads & Images"]
                    end
                    
                    subgraph Messaging["Event-Driven"]
                        ServiceBus["üì® Service Bus<br/>sb-registrationapp-eastus<br/>Async Messaging"]
                    end
                    
                    subgraph Serverless["Serverless Processing"]
                        Function["‚ö° Function App<br/>func-registrationapp<br/>Email Notifications"]
                    end
                    
                    Client -->|HTTP| Backend
                    Backend -->|Read/Store| SQL
                    Backend -->|Audit Log| Cosmos
                    Backend -->|Upload/Download| Blob
                    Backend -->|Publish Event| ServiceBus
                    ServiceBus -->|Trigger| Function
                    Function -->|Send Email| SendGrid["üìß SendGrid<br/>Email Service"]
                    
                    Backend -->|Secrets| KeyVault
                    Backend -->|Track Events| AppInsights
                    Cosmos -->|Track Logs| AppInsights
                    Function -->|Track Execution| AppInsights
                    
                    style Backend fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
                    style KeyVault fill:#10b981,stroke:#333,stroke-width:2px,color:#fff
                    style AppInsights fill:#f59e0b,stroke:#333,stroke-width:2px,color:#fff
                    style SQL fill:#0284c7,stroke:#333,stroke-width:2px,color:#fff
                    style Cosmos fill:#0284c7,stroke:#333,stroke-width:2px,color:#fff
                    style Blob fill:#0284c7,stroke:#333,stroke-width:2px,color:#fff
                    style ServiceBus fill:#7c3aed,stroke:#333,stroke-width:2px,color:#fff
                    style Function fill:#7c3aed,stroke:#333,stroke-width:2px,color:#fff
                </div>
            </div>

            <h3>Data Flow Diagram</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    participant User as üë§ User
                    participant API as üîß API
                    participant SQL as üíæ SQL Server
                    participant Cosmos as üìö Cosmos DB
                    participant SB as üì® Service Bus
                    participant Func as ‚ö° Function
                    participant Email as üìß SendGrid
                    participant AppIns as üìä App Insights
                    
                    User->>API: 1. Create Item (POST /api/items)
                    API->>SQL: 2. Save Item Data
                    SQL-->>API: 3. Return Item ID
                    API->>Cosmos: 4. Log Audit Event
                    Cosmos-->>API: 5. Confirm Logged
                    API->>SB: 6. Publish "ItemCreated" Event
                    SB-->>API: 7. Message Queued
                    API->>AppIns: 8. Track Event
                    API-->>User: 9. Return HTTP 200
                    
                    SB->>Func: 10. Trigger Function (email-notifications-queue)
                    Func->>Func: 11. Parse Message
                    Func->>Email: 12. Send Email Notification
                    Email-->>Func: 13. Email Sent (200 OK)
                    Func->>AppIns: 14. Log Execution
                    
                    AppIns-->>API: 15. Aggregate Metrics
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services">
            <h2>üîß Azure Services Overview</h2>

            <div class="service-grid">
                <!-- Key Vault -->
                <div class="service-card">
                    <h3>üîê Azure Key Vault</h3>
                    <span class="status complete">‚úÖ COMPLETE</span>
                    <p><strong>Resource:</strong> kv-registrationapp (East US)</p>
                    <p><strong>Purpose:</strong> Secure credential storage</p>
                    <h4>Secrets Stored:</h4>
                    <ul style="margin-top: 10px;">
                        <li>SqlConnectionString</li>
                        <li>StorageAccountConnectionString</li>
                        <li>ServiceBusConnectionString</li>
                        <li>CosmosDbConnectionString</li>
                        <li>SendGridApiKey</li>
                    </ul>
                </div>

                <!-- Storage Account -->
                <div class="service-card">
                    <h3>‚òÅÔ∏è Azure Storage Account</h3>
                    <span class="status complete">‚úÖ COMPLETE</span>
                    <p><strong>Resource:</strong> stregistrationapp2807 (East US)</p>
                    <p><strong>Purpose:</strong> File storage and uploads</p>
                    <h4>Containers:</h4>
                    <ul style="margin-top: 10px;">
                        <li><strong>uploads:</strong> User file uploads</li>
                        <li><strong>item-images:</strong> Product images</li>
                    </ul>
                </div>

                <!-- Service Bus -->
                <div class="service-card">
                    <h3>üì® Azure Service Bus</h3>
                    <span class="status complete">‚úÖ COMPLETE</span>
                    <p><strong>Resource:</strong> sb-registrationapp-eastus (East US)</p>
                    <p><strong>Purpose:</strong> Async messaging and event processing</p>
                    <h4>Queues:</h4>
                    <ul style="margin-top: 10px;">
                        <li><strong>item-created-queue:</strong> Item creation events</li>
                        <li><strong>email-notifications-queue:</strong> Email tasks</li>
                    </ul>
                </div>

                <!-- Cosmos DB -->
                <div class="service-card">
                    <h3>üìö Azure Cosmos DB</h3>
                    <span class="status complete">‚úÖ COMPLETE</span>
                    <p><strong>Resource:</strong> cosmos-registrationapp-india (Central India)</p>
                    <p><strong>Purpose:</strong> NoSQL audit logging</p>
                    <h4>Database:</h4>
                    <ul style="margin-top: 10px;">
                        <li><strong>RegistrationAppDb:</strong> Main database</li>
                        <li><strong>AuditLogs:</strong> Change tracking container</li>
                    </ul>
                </div>

                <!-- Function App -->
                <div class="service-card">
                    <h3>‚ö° Azure Function App</h3>
                    <span class="status complete">‚úÖ COMPLETE</span>
                    <p><strong>Resource:</strong> func-registrationapp (East US)</p>
                    <p><strong>Purpose:</strong> Serverless email notifications</p>
                    <h4>Function:</h4>
                    <ul style="margin-top: 10px;">
                        <li><strong>SendEmailNotification:</strong> Triggers on Service Bus messages</li>
                        <li><strong>Runtime:</strong> .NET 8.0 (dotnet-isolated)</li>
                        <li><strong>Plan:</strong> Consumption</li>
                    </ul>
                </div>

                <!-- App Insights -->
                <div class="service-card">
                    <h3>üìä Application Insights</h3>
                    <span class="status complete">‚úÖ COMPLETE</span>
                    <p><strong>Resource:</strong> Auto-created with Function App</p>
                    <p><strong>Purpose:</strong> Monitoring and observability</p>
                    <h4>Tracks:</h4>
                    <ul style="margin-top: 10px;">
                        <li>API request metrics</li>
                        <li>Function execution logs</li>
                        <li>Exception tracking</li>
                        <li>Performance metrics</li>
                    </ul>
                </div>
            </div>

            <h3>Services Comparison Table</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Region</th>
                        <th>Status</th>
                        <th>Purpose</th>
                        <th>Est. Cost/Month</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>üîê Key Vault</td>
                        <td>East US</td>
                        <td><span class="badge feature">‚úÖ Active</span></td>
                        <td>Secrets Management</td>
                        <td>$0.34</td>
                    </tr>
                    <tr>
                        <td>‚òÅÔ∏è Storage Account</td>
                        <td>East US</td>
                        <td><span class="badge feature">‚úÖ Active</span></td>
                        <td>File Storage</td>
                        <td>~$1</td>
                    </tr>
                    <tr>
                        <td>üì® Service Bus</td>
                        <td>East US</td>
                        <td><span class="badge feature">‚úÖ Active</span></td>
                        <td>Async Messaging</td>
                        <td>~$10</td>
                    </tr>
                    <tr>
                        <td>üìö Cosmos DB</td>
                        <td>Central India</td>
                        <td><span class="badge feature">‚úÖ Active</span></td>
                        <td>NoSQL Database</td>
                        <td>~$23</td>
                    </tr>
                    <tr>
                        <td>‚ö° Function App</td>
                        <td>East US</td>
                        <td><span class="badge feature">‚úÖ Ready</span></td>
                        <td>Serverless Processing</td>
                        <td>~$0-15</td>
                    </tr>
                    <tr>
                        <td>üìä App Insights</td>
                        <td>East US</td>
                        <td><span class="badge feature">‚úÖ Active</span></td>
                        <td>Monitoring</td>
                        <td>~$2-5</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Usage Section -->
        <section id="usage">
            <h2>üí° How Each Service Is Used</h2>

            <h3>1. üîê Key Vault - Secrets Management</h3>
            <p><strong>Why we use it:</strong> Never hardcode secrets in your application code.</p>
            <p><strong>How it works:</strong></p>
            <ul>
                <li>All connection strings stored securely in Azure Key Vault</li>
                <li>Application retrieves secrets at runtime using managed identity</li>
                <li>RBAC-based access control for security</li>
                <li>Automatic secret rotation support</li>
            </ul>
            <div class="code-block">
                <code>// Backend retrieves secrets at startup
var keyVaultUri = new Uri("https://kv-registrationapp.vault.azure.net/");
var credential = new DefaultAzureCredential();
builder.Configuration.AddAzureKeyVault(keyVaultUri, credential);

// Then use in code
var connStr = configuration["SqlConnectionString"];</code>
            </div>

            <h3>2. ‚òÅÔ∏è Storage Account - File Management</h3>
            <p><strong>Why we use it:</strong> Scalable, serverless file storage for user uploads.</p>
            <p><strong>How it works:</strong></p>
            <ul>
                <li>Users upload images/files through API</li>
                <li>Files stored in Azure Blob Storage containers</li>
                <li>API returns public URLs for downloaded files</li>
                <li>Automatic scaling and high availability</li>
            </ul>
            <div class="code-block">
                <code>// Upload file to Azure Storage
POST /api/items/1/upload-image
Content-Type: multipart/form-data

file: [binary image data]

// Response
{
  "imageUrl": "https://stregistrationapp2807.blob.core.windows.net/item-images/item-1-abc123.jpg",
  "uploadedAt": "2026-02-05T12:00:00Z"
}</code>
            </div>

            <h3>3. üì® Service Bus - Event-Driven Architecture</h3>
            <p><strong>Why we use it:</strong> Decouple components and process events asynchronously.</p>
            <p><strong>How it works:</strong></p>
            <ul>
                <li>API publishes "ItemCreated" event to Service Bus queue</li>
                <li>Function App listens for messages on the queue</li>
                <li>Function processes message and sends email</li>
                <li>Automatic retry and dead-letter queue for failures</li>
            </ul>
            <div class="code-block">
                <code>// API publishes event
var serviceBusClient = new ServiceBusClient(connectionString);
var sender = serviceBusClient.CreateSender("item-created-queue");

var message = new ServiceBusMessage(JsonSerializer.Serialize(new {
    itemName = item.Name,
    itemId = item.Id,
    createdAt = DateTime.UtcNow
}));

await sender.SendMessageAsync(message);</code>
            </div>

            <h3>4. üìö Cosmos DB - NoSQL Audit Logging</h3>
            <p><strong>Why we use it:</strong> Flexible schema for audit trails and logging.</p>
            <p><strong>How it works:</strong></p>
            <ul>
                <li>Every API operation creates an audit log in Cosmos DB</li>
                <li>Stores: action, user, timestamp, changes made</li>
                <li>No schema enforcement allows flexible data structures</li>
                <li>Easy querying of audit history</li>
            </ul>
            <div class="code-block">
                <code>// Cosmos DB audit log entry
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "action": "ItemCreated",
  "itemId": 1,
  "changedBy": "admin@example.com",
  "changes": {
    "name": "New Item",
    "description": "Item Description"
  },
  "timestamp": "2026-02-05T12:00:00Z",
  "partition": "1"
}</code>
            </div>

            <h3>5. ‚ö° Azure Functions - Serverless Processing</h3>
            <p><strong>Why we use it:</strong> Run code without managing infrastructure.</p>
            <p><strong>How it works:</strong></p>
            <ul>
                <li>Function triggered by Service Bus message</li>
                <li>Parses JSON message content</li>
                <li>Sends email via SendGrid API</li>
                <li>Auto-scales based on queue depth</li>
                <li>Pay only for execution time</li>
            </ul>
            <div class="code-block">
                <code>// Function code
[Function("SendEmailNotification")]
public async Task Run(
    [ServiceBusTrigger("email-notifications-queue")]
    ServiceBusReceivedMessage message)
{
    var notificationData = JsonSerializer.Deserialize&lt;NotificationData&gt;(
        message.Body.ToString());
    
    await SendEmailAsync(notificationData);
    
    // Message automatically completed on success
}</code>
            </div>

            <h3>6. üìä Application Insights - Monitoring</h3>
            <p><strong>Why we use it:</strong> Understand application health and performance.</p>
            <p><strong>How it works:</strong></p>
            <ul>
                <li>Automatically tracks API request metrics</li>
                <li>Logs function execution and errors</li>
                <li>Performance counters and dependency tracking</li>
                <li>Alerts on anomalies and failures</li>
            </ul>
        </section>

        <!-- Deployment Section -->
        <section id="deployment">
            <h2>üöÄ Deployment Guide</h2>

            <h3>Current Deployment Status</h3>
            <div class="timeline">
                <div class="timeline-item">
                    <h4>‚úÖ Phase 1: Core Services (Complete)</h4>
                    <p>Azure Key Vault, Storage Account, Service Bus, Cosmos DB, and App Insights are all deployed and integrated with the backend API.</p>
                </div>
                <div class="timeline-item">
                    <h4>‚úÖ Phase 2: Function App (Ready to Deploy)</h4>
                    <p>The ItemNotificationFunction project is fully developed, tested, and ready for deployment to Azure.</p>
                </div>
                <div class="timeline-item">
                    <h4>‚è≥ Phase 3: Logic Apps (Optional)</h4>
                    <p>Complete documentation provided for setting up Azure Logic Apps for item approval workflows.</p>
                </div>
            </div>

            <h3>Deploy Function App to Azure</h3>
            <p><strong>Estimated time:</strong> 10-15 minutes</p>
            
            <div class="deployment-steps">
                <h4>Step-by-Step Instructions:</h4>
                <ol>
                    <li>
                        <strong>Navigate to Function Project</strong>
                        <div class="code-block">
                            <code>cd C:\Users\Admin\source\repos\RegistrationApp\ItemNotificationFunction</code>
                        </div>
                    </li>
                    <li>
                        <strong>Build the Project</strong>
                        <div class="code-block">
                            <code>dotnet build --configuration Release</code>
                        </div>
                    </li>
                    <li>
                        <strong>Configure SendGrid (Optional)</strong>
                        <p>If not already done, get a SendGrid API key from <a href="https://sendgrid.com/" target="_blank">sendgrid.com</a></p>
                        <div class="code-block">
                            <code>$sendGridKey = "SG.xxxxxxxxxxxxxxxxxxxx"
az keyvault secret set `
  --vault-name kv-registrationapp `
  --name "SendGridApiKey" `
  --value $sendGridKey</code>
                        </div>
                    </li>
                    <li>
                        <strong>Run Deployment Script</strong>
                        <div class="code-block">
                            <code>.\deploy-function.ps1 `
  -FunctionAppName func-registrationapp `
  -ResourceGroup rg-registration-app</code>
                        </div>
                    </li>
                    <li>
                        <strong>Verify Deployment</strong>
                        <div class="code-block">
                            <code>az functionapp function list `
  --name func-registrationapp `
  --resource-group rg-registration-app</code>
                        </div>
                    </li>
                    <li>
                        <strong>Test Function</strong>
                        <p>Send a test message to the Service Bus queue:</p>
                        <div class="code-block">
                            <code>$testMessage = @{
  itemName = "Test Item"
  description = "Test Description"
  recipientEmail = "admin@example.com"
  recipientName = "Admin"
  createdBy = "Test User"
  createdAt = [DateTime]::Now
} | ConvertTo-Json

az servicebus queue send `
  --resource-group rg-registration-app `
  --namespace-name sb-registrationapp-eastus `
  --queue-name email-notifications-queue `
  --message-body $testMessage</code>
                        </div>
                    </li>
                </ol>
            </div>

            <h3>Monitor Function Execution</h3>
            <div class="code-block">
                <code># View live logs
az functionapp log tail `
  --name func-registrationapp `
  --resource-group rg-registration-app

# Or in Azure Portal: Function App > SendEmailNotification > Monitor</code>
            </div>

            <h3>Integrate with Backend API</h3>
            <p>To make the function work end-to-end, update your C# backend API to publish messages:</p>
            <div class="code-block">
                <code>// In your API controller when creating an item
public async Task&lt;IActionResult&gt; CreateItem([FromBody] CreateItemRequest request)
{
    // Save item to database
    var item = new Item { Name = request.Name, Description = request.Description };
    await context.Items.AddAsync(item);
    await context.SaveChangesAsync();
    
    // Publish event to Service Bus
    var message = new ServiceBusMessage(JsonSerializer.Serialize(new {
        itemName = item.Name,
        description = item.Description,
        recipientEmail = "admin@example.com",
        recipientName = "Admin",
        createdBy = User.Identity.Name,
        createdAt = DateTime.UtcNow
    }));
    
    await serviceBusClient.CreateSender("email-notifications-queue")
        .SendMessageAsync(message);
    
    return Ok(item);
}</code>
            </div>
        </section>

        <!-- Integration Flow Section -->
        <section id="integration">
            <h2>üîÑ Complete Integration Flow</h2>

            <h3>Item Creation Flow</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    graph LR
                    A["üåê User<br/>POSTs /api/items"] -->|1. HTTP Request| B["üîß API<br/>Validate & Process"]
                    B -->|2. Insert| C["üíæ SQL Server<br/>Save Item"]
                    C -->|3. Confirm| B
                    B -->|4. Create Log| D["üìö Cosmos DB<br/>Audit Entry"]
                    D -->|5. Logged| B
                    B -->|6. Publish| E["üì® Service Bus<br/>ItemCreated Queue"]
                    E -->|7. Message Queued| B
                    B -->|8. Track| F["üìä App Insights<br/>Log Event"]
                    F -->|9. Tracked| B
                    B -->|10. Response| A
                    
                    E -->|11. Trigger| G["‚ö° Function App<br/>SendEmailNotification"]
                    G -->|12. Parse| H["üìß SendGrid<br/>Send Email"]
                    H -->|13. Email Sent| G
                    G -->|14. Log| F
                    
                    style A fill:#667eea,color:#fff
                    style B fill:#667eea,color:#fff
                    style C fill:#0284c7,color:#fff
                    style D fill:#0284c7,color:#fff
                    style E fill:#7c3aed,color:#fff
                    style F fill:#f59e0b,color:#fff
                    style G fill:#7c3aed,color:#fff
                    style H fill:#10b981,color:#fff
                </div>
            </div>

            <h3>File Upload Flow</h3>
            <div class="diagram-container">
                <div class="mermaid">
                    graph LR
                    A["üåê User<br/>Uploads Image"] -->|1. POST /api/items/1/upload-image| B["üîß API<br/>Validate File"]
                    B -->|2. Valid?| C{Check}
                    C -->|No| B
                    C -->|Yes| D["‚òÅÔ∏è Storage Account<br/>Upload to Blob"]
                    D -->|3. File Stored| B
                    B -->|4. Log Upload| E["üìö Cosmos DB<br/>Create Audit"]
                    E -->|5. Logged| B
                    B -->|6. Return URL| A
                    B -->|7. Track| F["üìä App Insights"]
                    
                    style A fill:#667eea,color:#fff
                    style B fill:#667eea,color:#fff
                    style D fill:#0284c7,color:#fff
                    style E fill:#0284c7,color:#fff
                    style F fill:#f59e0b,color:#fff
                </div>
            </div>

            <h3>Data Consistency</h3>
            <div class="info-box">
                <strong>üîÑ Eventual Consistency Model</strong>
                <p>
                    The system uses eventual consistency for audit logs:
                </p>
                <ol>
                    <li>API writes to SQL Server (strongly consistent)</li>
                    <li>Audit log written to Cosmos DB (may take milliseconds)</li>
                    <li>Event published to Service Bus (queued for processing)</li>
                    <li>Function executes when queue is processed</li>
                </ol>
                <p>
                    This ensures high performance while maintaining audit trails. In the rare event of failures, 
                    Service Bus automatic retries and dead-letter queues ensure no messages are lost.
                </p>
            </div>
        </section>

        <!-- Monitoring Section -->
        <section id="monitoring">
            <h2>üìä Monitoring & Troubleshooting</h2>

            <h3>Monitoring Checklist</h3>
            <div class="deployment-steps">
                <ul>
                    <li>
                        <strong>API Health</strong>
                        <div class="code-block">
                            <code>curl https://registration-api-prod.azurecontainer.io/health</code>
                        </div>
                    </li>
                    <li>
                        <strong>Service Bus Queue Depth</strong>
                        <div class="code-block">
                            <code>az servicebus queue show-runtime-properties `
  --resource-group rg-registration-app `
  --namespace-name sb-registrationapp-eastus `
  --name email-notifications-queue `
  --query "{ActiveMessages: activeMessageCount, DeadLetterMessages: deadLetterMessageCount}"</code>
                        </div>
                    </li>
                    <li>
                        <strong>Function Execution Logs</strong>
                        <div class="code-block">
                            <code>az functionapp log tail `
  --name func-registrationapp `
  --resource-group rg-registration-app</code>
                        </div>
                    </li>
                    <li>
                        <strong>Application Insights Queries</strong>
                        <p>In Azure Portal, go to Application Insights > Logs and run:</p>
                        <div class="code-block">
                            <code>// Failed requests
requests
| where success == false
| summarize FailureCount=count() by name, resultCode

// Function execution time
customMetrics
| where name == "FunctionExecutionTime"
| summarize AvgDuration=avg(value) by tostring(customDimensions.FunctionName)</code>
                        </div>
                    </li>
                </ul>
            </div>

            <h3>Common Issues & Solutions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Issue</th>
                        <th>Symptoms</th>
                        <th>Solution</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Key Vault Access Denied</td>
                        <td>403 Forbidden when accessing secrets</td>
                        <td>Grant yourself "Key Vault Secrets Officer" role in the portal or using CLI</td>
                    </tr>
                    <tr>
                        <td>Service Bus Messages Not Processing</td>
                        <td>Messages stuck in queue, Function not triggered</td>
                        <td>Check Function App is deployed and running; verify connection string is correct</td>
                    </tr>
                    <tr>
                        <td>Cosmos DB Quota Exceeded</td>
                        <td>HTTP 429 errors when writing audit logs</td>
                        <td>Increase RU/s in Azure Portal or implement backoff retry logic</td>
                    </tr>
                    <tr>
                        <td>Storage Account Upload Fails</td>
                        <td>Blob upload returns 401 or 403</td>
                        <td>Verify storage account connection string in Key Vault; check CORS settings</td>
                    </tr>
                    <tr>
                        <td>Function Cold Start Delays</td>
                        <td>First execution after idle period is slow</td>
                        <td>Consider upgrading to Premium plan for better performance; pre-warm function periodically</td>
                    </tr>
                </tbody>
            </table>

            <h3>Performance Optimization Tips</h3>
            <ul>
                <li>
                    <strong>Database:</strong> Add indexes on frequently queried columns in SQL Server
                </li>
                <li>
                    <strong>Cosmos DB:</strong> Use partition key wisely to distribute data evenly
                </li>
                <li>
                    <strong>Storage:</strong> Enable CDN for static content served from Blob Storage
                </li>
                <li>
                    <strong>Service Bus:</strong> Batch messages for better throughput
                </li>
                <li>
                    <strong>Function App:</strong> Use connection pooling to reuse HTTP clients
                </li>
                <li>
                    <strong>App Insights:</strong> Set sampling for high-volume applications to reduce costs
                </li>
            </ul>
        </section>

        <!-- FAQ Section -->
        <section id="faq">
            <h2>‚ùì Frequently Asked Questions</h2>

            <h3>General Questions</h3>
            <dl>
                <dt>Q: Why use multiple storage services (SQL + Cosmos DB)?</dt>
                <dd>
                    SQL Server is great for transactional data with ACID properties. Cosmos DB is perfect for 
                    audit logs where schema flexibility is important. Using the right tool for the job improves 
                    performance and maintainability.
                </dd>

                <dt>Q: How do we handle secrets securely?</dt>
                <dd>
                    All secrets are stored in Azure Key Vault with RBAC-based access control. The application 
                    uses Managed Identity to authenticate to Key Vault at runtime, eliminating the need to store 
                    credentials in configuration files.
                </dd>

                <dt>Q: What happens if the Function App crashes?</dt>
                <dd>
                    Service Bus messages have built-in retry logic. If a function fails to process a message, 
                    it's automatically retried. After the retry limit is reached, messages are moved to a 
                    dead-letter queue for manual review.
                </dd>

                <dt>Q: How much will this cost?</dt>
                <dd>
                    Estimated monthly cost: $36-54 (depending on usage). Key Vault ($0.34), Storage (~$1), 
                    Service Bus (~$10), Cosmos DB (~$23), Function App (~$0-15), App Insights (~$2-5).
                </dd>
            </dl>

            <h3>Deployment Questions</h3>
            <dl>
                <dt>Q: Can I deploy the Function App manually instead of using the script?</dt>
                <dd>
                    Yes. Use <code>func azure functionapp publish func-registrationapp</code> after building the project. 
                    The script just automates this along with configuration steps.
                </dd>

                <dt>Q: How do I update the Function App code?</dt>
                <dd>
                    Make changes to the code, rebuild, then run the deployment script again. The new code will 
                    be published to Azure.
                </dd>

                <dt>Q: Can I test locally before deploying?</dt>
                <dd>
                    Yes. Run <code>func start</code> in the ItemNotificationFunction directory. The function 
                    will listen for local Service Bus messages if you update local.settings.json.
                </dd>
            </dl>

            <h3>Operational Questions</h3>
            <dl>
                <dt>Q: How do I monitor the Function App in production?</dt>
                <dd>
                    Use Application Insights (auto-created with Function App) or check Azure Portal > 
                    Function App > Monitor. You can also stream logs using <code>az functionapp log tail</code>.
                </dd>

                <dt>Q: What should I do if emails aren't being sent?</dt>
                <dd>
                    Check 1) SendGrid API key is configured, 2) Sender email is verified in SendGrid, 
                    3) Function logs show no errors, 4) Service Bus queue has messages, 5) Check dead-letter queue 
                    for failed messages.
                </dd>

                <dt>Q: How do I scale the system for more users?</dt>
                <dd>
                    Most services scale automatically (Service Bus, Function App on consumption plan, Storage). 
                    For database, consider read replicas for SQL Server or increase RU/s for Cosmos DB. 
                    Enable Application Insights alerts for proactive scaling.
                </dd>
            </dl>
        </section>

        <!-- Footer -->
        <div class="footer">
            <p><strong>RegistrationApp - Azure Integration Documentation</strong></p>
            <p>Version 1.0 | Last Updated: February 5, 2026</p>
            <p>All services deployed and tested in Azure</p>
            <p>
                <span class="badge azure">Azure Key Vault</span>
                <span class="badge azure">Azure Storage</span>
                <span class="badge azure">Service Bus</span>
                <span class="badge azure">Cosmos DB</span>
                <span class="badge azure">Function App</span>
                <span class="badge azure">App Insights</span>
                <span class="badge dotnet">.NET 8.0</span>
                <span class="badge dotnet">ASP.NET Core</span>
            </p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            securityLevel: 'loose',
            theme: 'default',
            logLevel: 'error'
        });
        mermaid.contentLoaded();
    </script>
</body>
</html>
